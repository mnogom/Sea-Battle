"""Render."""

import os

from sea_battle.field import Field
from sea_battle.ship import DAMAGED, UNDAMAGED

FIELD_TEMPLATE = """
╭────────────────────────────────────────────────╮
│ ███████████████ Player's Field ███████████████ │
│ ╔═══╦═══╤═══╤═══╤═══╤═══╤═══╤═══╤═══╤═══╤═══╗  │
│ ║ x ║ 0 │ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │ 7 │ 8 │ 9 ║  │
│ ╠═══╬═══╪═══╪═══╪═══╪═══╪═══╪═══╪═══╪═══╪═══╣  │
│ ║ 0 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 1 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 2 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 3 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 4 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 5 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 6 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 7 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 8 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 9 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╚═══╩═══╧═══╧═══╧═══╧═══╧═══╧═══╧═══╧═══╧═══╝  │
├────────────────────────────────────────────────┤
│ █████████████████ AI's Field █████████████████ │
│ ╔═══╦═══╤═══╤═══╤═══╤═══╤═══╤═══╤═══╤═══╤═══╗  │
│ ║ x ║ 0 │ 1 │ 2 │ 3 │ 4 │ 5 │ 6 │ 7 │ 8 │ 9 ║  │
│ ╠═══╬═══╪═══╪═══╪═══╪═══╪═══╪═══╪═══╪═══╪═══╣  │
│ ║ 0 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 1 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 2 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 3 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 4 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 5 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 6 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 7 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 8 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╟───╫───┼───┼───┼───┼───┼───┼───┼───┼───┼───╢  │
│ ║ 9 ║{}│{}│{}│{}│{}│{}│{}│{}│{}│{}║  │
│ ╚═══╩═══╧═══╧═══╧═══╧═══╧═══╧═══╧═══╧═══╧═══╝  │
╰────────────────────────────────────────────────╯
"""
ELIMINATED_MARKER = "\33[41m F \33[0m"
DAMAGED_MARKER = "\33[43m X \33[0m"
UNDAMAGED_MARKER = " O "
MISSED_MARKER = "\33[44m * \33[0m"
CLEAN_MARKER = "   "


def _get_marker(field: Field, coord: tuple[int, int], player: bool) -> str:
    target_ship = field.get_ship_intersection(coord)

    if target_ship:
        if target_ship.is_eliminated():
            return ELIMINATED_MARKER

        deck_index = target_ship.get_deck_index(coord)
        deck_status = target_ship.get_deck_status(deck_index)
        if deck_status == DAMAGED:
            return DAMAGED_MARKER
        if deck_status == UNDAMAGED:
            return UNDAMAGED_MARKER if player else CLEAN_MARKER

    if coord in field.get_hited_cells():
        return MISSED_MARKER
    return CLEAN_MARKER


def _clear_console() -> None:
    os.system("clear")


def render_fields(player_field: Field, ai_field: Field) -> None:
    _clear_console()
    x_len = player_field.get_x_len()
    y_len = player_field.get_y_len()
    player_markers = []
    ai_markers = []
    for x in range(x_len):
        for y in range(y_len):
            marker = _get_marker(player_field, (x, y), player=True)
            player_markers.append(marker)

            marker = _get_marker(ai_field, (x, y), player=False)
            ai_markers.append(marker)

    print(FIELD_TEMPLATE.format(*player_markers, *ai_markers))
